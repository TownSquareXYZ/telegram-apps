---
outline:
  - 2
  - 4
---

# Получение ссылки на приложение

Если кратко, все мини-приложения - это обычные веб-приложения, каждое из которых требует свой собственный URL, используемый
для загрузки и отображения содержимого приложения. Telegram не предоставляет хранилище для приложений, поэтому разработчик сам должен создать хранилище для своего приложения
и получить его URL.

Telegram принимает только ссылки с действительным SSL-сертификатом, использующие протокол HTTPS. В отличие от рабочей среды, [тестовая среда](test-environment.md) позволяет напрямую использовать IP-адрес.

::: info

Несмотря на то, что тестовая среда может использоваться для разработки приложений, она часто демонстрирует  низкую производительность. Если вы столкнулись с низкой производительностью в тестовой среде, рассмотрите возможность перехода в рабочую среду.

:::

## Введение

Прежде чем вы приступите к изучению этого руководства, важно понять, зачем вам нужны те или иные ссылки. В большинстве случаев
ссылки на приложения нужны для одной из следующих целей:

1. **Для разработки**: эти ссылки являются временными и используются только для отображения приложения на сервере разработки. Их также можно использовать для обмена с другими пользователями, чтобы показать текущий прогресс.
2. **Для продакшена**: Эти ссылки используются в режиме продакшена, для открытия готового к использованию приложения, доступного обычным пользователям.

В этом руководстве рассматриваются оба случая. Вы можете найти примеры создания и использования реальных ссылок в
[шаблоне для React.js](https://github.com/telegram-mini-apps/reactjs-template).

В следующих разделах этой документации в качестве основного бандлера приложений будет использоваться [Vite](https://vitejs.dev).

## Для разработки

Процесс разработки приложений считается бесконечным. Долгосрочные приложения всегда требуют поддержки, поэтому важно совершенствовать процесс, снижая порог входа и уменьшая когнитивную нагрузку.

Ссылки для разработки используются для просмотра приложения в его текущем состоянии разработки. Эти ссылки можно
разделить на два типа: локальные и удаленные. Рассмотрим их подробнее.

::: warning

Ссылки для разработки не предназначены для использования в продакшене. Ссылки для продакшена не должны быть динамическими
и должны ссылаться на сервер, предоставляющий контент для мини-приложения.

:::

### Локальные ссылки

Локальная ссылка для разработки - это ссылка, которая будет доступна только на текущем устройстве.

Популярные бандлеры, такие как [Vite](https://vitejs.dev/), позволяют запускать локальный сервер для разработки. В результате вы получите IP-адрес, который можно использовать в BotFather или открыть напрямую в браузере.

Вот базовая конфигурация Vite для запуска сервера разработки и возврата ссылки для разработки.

```ts
import { defineConfig } from 'vite';

export default defineConfig();
```

Сообщение, которое вы увидите в консоли:

```bash
VITE ready in 112 ms

➜  Local:   http://localhost:5173
➜  press h + enter to show help
```

Теперь вы можете открыть ссылку `Local` (`http://localhost:5173`) в своем браузере и посмотреть приложение.

Как вы могли заметить, эта ссылка не соответствует требованиям BotFather, так как должна использовать
протокол HTTPS. Теперь давайте получим HTTPS-ссылку.

#### Плагин Vite

Экосистема Vite предоставляет
плагин [@vitejs/plugin-basic-ssl](https://www.npmjs.com/package/@vitejs/plugin-basic-ssl). Он позволяет запускать приложение с самоподписанными SSL-сертификатами на указанном домене.

Вот базовый пример:

```ts
import { defineConfig } from 'vite';
import basicSsl from '@vitejs/plugin-basic-ssl';

export default defineConfig({
  plugins: [
    basicSsl(),
  ],
});
```

Есть несколько дополнительных опций, которые могут вам пригодиться. Чтобы узнать о них больше, ознакомьтесь с [документацией](https://www.npmjs.com/package/@vitejs/plugin-basic-ssl) плагина.

После запуска сервера разработки, вы увидите аналогичное сообщение:

```bash
VITE ready in 275 ms

➜  Local:   https://localhost:5173
➜  press h + enter to show help
```

Ссылка `Local` (`https://localhost:5173`) ведет на локальный сервер разработки. При открытии этой ссылки
в браузере, Telegram для macOS, Telegram Desktop или Telegram Web A/K появится предупреждение о ненадежном сертификате.

<img
src="/untrusted-cert-warning.png"
class="guides-image"
style="border: 1px solid #ebebeb"
/>

Просто сделайте исключение для этого и переходите к приложению.

#### mkcert

[mkcert](https://github.com/FiloSottile/mkcert) - это инструмент, позволяющий разработчикам создавать SSL-сертификаты
вместе с соответствующим закрытым ключом. Он также создает центр сертификации (CA), который позволяет
локальному устройству доверять созданному сертификату. Вот [руководство по установке](https://github.com/FiloSottile/mkcert?tab=readme-ov-file#installation).

Допустим, вы хотите создать собственный домен, известный только вашему устройству, который будет использоваться
только в целях разработки. Пусть он будет называться, например, `tma.internal`. Чтобы ваше текущее устройство
знало, какой IP связан с этим доменом, мы должны изменить файл [hosts](https://en.wikipedia.org/wiki/Hosts_\(file\)) и сопоставить `tma.internal` с `127.0.0.1`.

Затем вам нужно запустить инструмент mkcert, указав этот домен, и получить два файла: сертификат SSL
и закрытый ключ. Оба этих файла нужно указывать в конфигурации Vite.

Вот пример конфигурации сервера разработки Vite с использованием сущностей, сгенерированных mkcert:

```typescript
import { defineConfig } from 'vite';
import { resolve } from 'node:path';
import { readFileSync } from 'node:fs';

export default defineConfig({
  server: {
    host: 'tma.internal',
    https: {
      cert: readFileSync(resolve('tma.internal.pem')),
      key: readFileSync(resolve('tma.internal-key.pem')),
    },
  },
});
```

### Сеть

Могут возникнуть ситуации, когда разработчику потребуется открыть приложение на разных устройствах. Мы имплементируем такую возможность, используя опцию [host](https://vitejs.dev/config/server-options.html#server-host) от Vite.

Давайте посмотрим, как выглядит соответствующая конфигурация:

```typescript
import { defineConfig } from 'vite';

export default defineConfig({
  server: {
    host: true,
  },
});
```

Как альтернативу можно использовать следующую команду: `vite --host`.

После запуска сервера разработки, вы увидите аналогичное сообщение в своей консоли:

```bash
  VITE v5.2.12  ready in 15 ms

  ➜  Local:   http://localhost:5173
  ➜  Network: http://172.20.10.8:5173
  ➜  press h + enter to show help
```

Теперь вы можете получить доступ к ссылке `Network` (`http://172.20.10.8:5173`) на устройствах в той же сети.

Чтобы получить HTTPS-ссылку, обратитесь к предыдущим разделам этого руководства.

### Удаленные ссылки

Ссылка для удаленной разработки - это временная ссылка, которую можно использовать для получения доступа к серверу разработки, даже с устройств, расположенных в другой сети.

Чтобы создать ссылку такого типа, сначала нужно запустить локальный сервер разработки и
получить IP-адрес, который можно использовать для доступа к приложению. Например, таким IP-адресом может
быть `127.0.0.1:5432`. Однако этот IP-адрес не позволит устройствам из другой сети получить доступ к приложению.

Чтобы решить эту проблему, вам нужно создать некий туннель, ведущий к локальному IP-адресу. Для этого мы используем сторонние, условно бесплатные сервисы, такие как [ngrok](https://ngrok.com/)
и [localtunnel](https://localtunnel.github.io/www/).

#### Ngrok

Чтобы начать использовать [ngrok](https://ngrok.com/), вам нужно зарегистрироваться, а затем перейти на
страницу [настроек](https://dashboard.ngrok.com/get-started/setup).

Далее нужно создать туннель, ведущий к вашему серверу разработки. У каждого пользователя есть как минимум 1 бесплатный статический домен, который можно использовать в BotFather. Чтобы найти свой домен, перейдите по этой [ссылке](https://dashboard.ngrok.com/cloud-edge/domains).

Когда статический домен будет получен, создайте туннель с помощью этой команды:

```bash
ngrok http --domain={YOUR_STATIC_DOMAIN} {YOU_DEV_SERVER_PORT}
```

Итак, если статический домен - `example.free.ngrok.app`, а ваш сервер разработки запущен по адресу `http://127.0.0.1:5432`, команда будет выглядеть так:

```bash
ngrok http --domain=example.free.ngrok.app 5432
```

После создания туннеля пользователи, открывающие мини-приложение, будут перенаправлены на ваш сервер разработки.

#### Localtunnel

[Localtunnel](https://localtunnel.github.io/www/) - это полностью бесплатная альтернатива ngrok. Чтобы начать использовать localtunnel, вам нужно установить соответствующий пакет с помощью npm:

```bash
npm install -g localtunnel
```

Затем используйте команду для создания туннеля:

```bash
lt -s mysubdomain --port 5432
```

Пакет вернет следующий URL-адрес, который можно использовать в BotFather:

```
https://mysubdomain.loca.lt
```

## Для продакшена

Получить ссылку для продакшена также совсем не сложно. Для этого можно воспользоваться популярными бесплатными статическими сервисами:

- [GitHub Pages](https://pages.github.com/)
- [Heroku](https://www.heroku.com/)
- [Vercel](https://vercel.com/)

Однако разработчик может использовать и любой другой хостинг. Важно помнить, что ссылка на
приложения должна работать по протоколу HTTPS и иметь действующий SSL-сертификат. Чтобы получить бесплатный сертификат, воспользуйтесь [certbot](https://certbot.eff.org/pages/about).
