---
outline:
  - 2
  - 3
---

# Хостинг

С помощью быстрого и надежного хостинга Mate разработчики могут эффективно управлять статическими активами
для своих мини-приложений. Эффективная и безопасная доставка статических файлов крайне важна для оптимальной производительности.

Благодаря использованию сети доставки контента (CDN) хостинг Mate повышает надёжность и ускоряет загрузку файлов для пользователей из разных регионов, превосходя по производительности решения с одним сервером.

Услуга хостинга бесплатна, однако имеются некоторые ограничения на передачу данных.

> [!ПРЕДУПРЕЖДЕНИЕ]
> Если в настоящее время вы используете один сервер как для размещения статических файлов, так и для серверных операций, переход на хостинг Mate может потребовать корректировки кода. Если ваше приложение уже различает статические и динамические запросы, интеграция будет намного проще.

### Важная рекомендация:

При развертывании SPA на платформе статического хостинга (например, на хостинге Mate) очень важно выбрать методы маршрутизации, которые не зависят от серверных конфигураций.

Маршрутизация на основе хеша (с использованием символа # в URL-адресах) - это простой и эффективный способ управления маршрутами, не требующий поддержки сервера. Многие фреймворки предлагают встроенные решения или плагины для реализации такого типа маршрутизации.

Например, если вы используете _React_, используйте `HashRouter` вместо `BrowserRouter`:

```jsx
import { HashRouter as Router, Route, Switch } from 'react-router-dom';

function App() {
  return (
    <Router>
      <Switch>
        <Route exact path="/" component={Home} />
        {/* Other routes */}
      </Switch>
    </Router>
  );
}

export default App;
```

## Возможности

### Молниеносная скорость

Ключевая особенность хостинга Mate - это хорошо настроенная сеть доставки контента (CDN), охватывающая весь мир и страны, где активно используются мини-приложения. Эта возможность позволяет разработчикам сосредоточиться на создании своих приложений, а не беспокоиться о том, как максимально быстро доставлять статические ресурсы.

### Система управления версиями

Еще одной важной особенностью хостинга является система управления версиями.

Mate позволяет создать до пяти тегов развертывания, что дает разработчикам возможность
развернуть проект с определенным тегом, не затрагивая ранее развернутые ресурсы.

#### Пример использования

Распространенный пример использования, это когда у проекта есть две версии: `latest` и `staging`. Разработчик может использовать версию `latest` для продакшена, а
`staging` - для команды контроля качества (QA).

После развертывания ресурсов `staging` команда QA проверяет, является ли это состояние
приемлемым. Затем эти же ресурсы могут быть развернуты с тегом `latest` для продакшена.

#### О базовом URL

При развертывании статических ресурсов Mate использует следующий базовый шаблон URL:

```
https://{storage_key}.tapps.global/{tag}
```

Вот некоторая информация об этих параметрах для пояснения:

- `storage_key`: уникальный ключ для развернутого проекта. Это значение нельзя изменить, оно присваивается проекту при его создании.
- `tag`: тег развертывания. Это значение устанавливается разработчиком в процессе развертывания. Примеры включают `staging`, `latest`, `dev` и т.д.

## Начало работы

### Шаг 1: Зарегистрируйте проект

Чтобы начать пользоваться функционалом хостинга, необходимо зарегистрировать проект и
получить его токен для его развертывания. Чтобы получить токен, зайдите в [@tma_mate_bot](https://t.me/tma_mate_bot) и нажмите кнопку `Start` для начала диалога с ботом.

<p align="center">
  <img src="/mate/start.png" width="320"/>
</p>

Затем нажмите кнопку `Create a Project` и введите название создаваемого проекта, следуя указанным правилам.

<p align="center">
  <img src="/mate/create.png" width="320"/>
</p>

После этого шага бот вернет информацию о созданном проекте, включая
**токен развертывания**.

### Шаг 2: Обновите базовый URL-адрес статических ресурсов

Перед развертыванием проекта убедитесь, что все статические ресурсы имеют допустимый базовый URL. Подробнее о том, как Mate генерирует базовый URL статических ресурсов, можно узнать [здесь](#about-base-url).

Чтобы получить информацию о развертывании проекта по определенному тегу, используйте следующую команду:

```bash
mate deploy info \
  --token {DEPLOYMENT_TOKEN} \
  --project {PROJECT_ID} \
  --tag {TAG}
```

Здесь значения `DEPLOYMENT_TOKEN` и `PROJECT_ID` относятся к токену развертывания
и идентификатору проекта, полученным на предыдущем шаге. `TAG` - это имя тега версии развертывания.

Пример вывода:

```
✔ Fetched deploy information for paper-planes (id 48) project
Project Title: paper-planes
Short title of the project
--------
Base Path (using tag "staging"): https://35f105bd6b.tapps.global/staging
This path will be used as a base path for the uploaded assets associated with this project. 
Consider using this value as a base path in your bundler. You can also use different tags using the --tag option.
--------
Allowed file extensions: html, css, js, cjs, mjs, png, jpg, jpeg, webp, ttf, woff, woff2, eot, json, ico
Files extensions that are allowed to be uploaded.
--------
Maximum size: 10485760 bytes
Maximum upload size.
--------
Maximum files count: 100
Maximum number of files a single upload can contain.
```

Значение `https://35f105bd6b.tapps.global/staging` - это базовый URL-адрес, который следует
использовать в сборщике проекта.

Вот как это можно применить, используя [Vite](https://vitejs.dev).

```ts
import { defineConfig } from 'vite';

export default defineConfig({
  base: 'https://35f105bd6b.tapps.global/staging'
});
```

### Шаг 3: Развертывание проекта

Для развертывания проекта в Mate необходимо указать папку, которая будет загружена на хостинг. Папка должна содержать только те файлы, которые могут быть открыты в браузере пользователя, поэтому в директории не должно быть
исходных файлов или файлов, предназначенных для других целей.

Предположим следующие условия:

- Был создан проект с ID `48` и токеном `aabbccdd`.
- Папка с именем `dist` содержит все статические ресурсы, созданные мини-приложением.
- Необходимо развернуть статические ресурсы с тегом `latest`.

Чтобы развернуть проект в этих условиях, выполните следующую команду:

```bash
mate deploy upload \
  --dir dist \
  --token aabbccdd \
  --project 48 \
  --tag latest
```

Вот возможный результат:

```
✔ Fetched deploy information for paper-planes (id 48) project
i Assets base path (using tag "latest"): 
https://35f105bd6b.tapps.global/latest
i Allowed file extensions: html, css, js, cjs, mjs, png, jpg, jpeg, webp, ttf, woff, woff2, eot, json, ico
i Maximum upload size: 10485760 bytes
i Maximum files count: 100
✔ Directory compressed successfully from 24185 to 7168 bytes
✔ Archive uploaded successfully
📁 dist
╰ 📄 index.js (https://35f105bd6b.tapps.global/latest/index.js)
```

> [!ПРЕДУПРЕЖДЕНИЕ]
> Развернутый каталог должен содержать только стандартные файлы и директории, за исключением приватных (начинающихся с символа `.`). Все остальные типы файлов
> (например, симлинки) запрещены. Если они будут обнаружены в процессе развертывания,
> инструмент CLI выдаст соответствующую ошибку.

### Шаг 4: Проверьте развертывание и настройте мини-приложение Telegram

После развертывания рекомендуется проверить, корректно ли работает ваше приложение, перейдя по прямой ссылке:

```
https://{storage_key}.tapps.global/{tag}/index.html
```

Если все работает корректно, используйте эту ссылку в качестве URL-адреса веб-приложения при создании мини-приложения Telegram.

**Пример:**

Если ваш storage_key 35f105bd6b, а ваш тег - latest, ссылка будет выглядеть так:

```
https://35f105bd6b.tapps.global/latest/index.html
```

Убедитесь, что при переходе по этой ссылке ваше приложение загружается и работает без ошибок. Это гарантирует, что ваше мини-приложение Telegram будет корректно работать с вашим хостингом.

## Использование конфигурации

Чтобы избежать повторного указания параметров, Mate позволяет создать специальную конфигурацию
со всеми включенными параметрами.

Чтобы начать использовать конфигурацию Mate вместе с дополнительными конфигурациями команд, создайте файл `mate.yml` или `mate.json` файл в корневом директории проекта со следующим содержимым:

:::code-group

```yml [mate.yml]
deploy:
  projectId: 48
  directory: dist
  token: aabbccdd
  tag: latest
```

```json [mate.json]
{
  "deploy": {
    "projectId": 48,
    "directory": "dist",
    "token": "aabbccdd",
    "tag": "latest"
  }
}
```

:::

Затем команды `info` и `upload` получат значения из конфигурации.

```bash
# Both of these commands will use the following 
# options from the Mate config:
# --project = 48
# --dir "dist"
# --token "aabbccdd"
# --tag "latest"
mate deploy info
mate deploy upload
```

Если требуется переопределить какой-либо параметр, его следует указать в команде.
Например, чтобы переопределить параметр `tag` значением `staging`, используйте следующую команду:

```bash
mate deploy info --tag staging
```
